<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Toastmasters Awards Voting</title>
<link rel="icon" href="https://imgs.search.brave.com/5PKYVDNULmpZoz9QSEnubWzI1Jh3oJmAbL8EhcsJC6c/rs:fit:500:0:1:0/g:ce/aHR0cHM6Ly91cGxv/YWQud2lraW1lZGlh/Lm9yZy93aWtpcGVk/aWEvZW4vdGh1bWIv/MC8wNS9Ub2FzdG1h/c3RlcnNfMjAxMS5w/bmcvNTEycHgtVG9h/c3RtYXN0ZXJzXzIw/MTEucG5n" type="image/png">
<style>
:root{
  --bg:#f3f5f7; --panel:#ffffff; --muted:#6b7280; --text:#111827;
  --brand:#0072CE; --accent:#FF6A13; --ok:#10b981; --danger:#ef4444;
  --radius:8px;
}
*{box-sizing:border-box;}
body{margin:0; font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial; background:var(--bg); color:var(--text); min-height:100vh; display:flex; flex-direction:column; align-items:center; padding:20px;}
.header-top{width:100%; max-width:1100px; display:flex; align-items:center; gap:12px; margin-bottom:20px;}
.header-top img{height:50px;}
.header-top h1{font-size:24px; color:var(--brand); margin:0;}
.app {width:100%; max-width:1100px; display:grid; grid-template-columns:1fr 380px; gap:20px;}
.card { background:var(--panel); padding:18px; border-radius:var(--radius); box-shadow:0 4px 15px rgba(0,0,0,.1); }
h1,h2,h3 { margin:4px 0; }
.muted{ color:var(--muted); font-size:13px; }
label{display:block; font-size:14px; color:var(--text); margin:10px 0 6px;}
input[type=text], input[type=password]{ width:100%; padding:10px; border-radius:6px; border:1px solid #d1d5db; background:#f9fafb; color:var(--text); }
button{ padding:10px 12px; border-radius:6px; border:none; cursor:pointer; font-weight:600;}
.btn-primary{ background:var(--brand); color:white; }
.btn-ghost{ background:#e5e7eb; color:var(--text); }
.small{ font-size:13px; padding:6px 8px; }
.hidden{ display:none; }
.candidate-row{ display:flex; gap:8px; align-items:center; margin-bottom:8px; }
.inline-btn{ padding:6px 8px; border-radius:6px; border:none; cursor:pointer; }
.danger{ background:var(--danger); color:white; }
.ok{ background:var(--ok); color:white; }
.results-item{ display:flex; justify-content:space-between; padding:8px; border-radius:6px; background:#f3f4f6; margin-bottom:6px; }
.footer { text-align:center; color:var(--muted); font-size:12px; margin-top:12px; }
#copyright { text-align:center; color:var(--muted); font-size:13px; margin-top:20px; }
#copyright div{ margin:2px 0; }
@media (max-width:980px){ .app{ grid-template-columns: 1fr; } .card { margin-bottom:12px; } }
</style>
</head>
<body>

<div class="header-top">
  <img src="https://imgs.search.brave.com/5PKYVDNULmpZoz9QSEnubWzI1Jh3oJmAbL8EhcsJC6c/rs:fit:500:0:1:0/g:ce/aHR0cHM6Ly91cGxv/YWQud2lraW1lZGlh/Lm9yZy93aWtpcGVk/aWEvZW4vdGh1bWIv/MC8wNS9Ub2FzdG1h/c3RlcnNfMjAxMS5w/bmcvNTEycHgtVG9h/c3RtYXN0ZXJzXzIw/MTEucG5n" alt="Toastmasters Logo">
  <h1>Toastmasters Club of Pune South East</h1>
</div>

<div class="app">
  <!-- Voting Side -->
  <div class="card" id="voterCard">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <h2 id="eventTitle">Toastmasters Awards Voting</h2>
        <div class="muted" id="eventSub">Select candidates and submit your vote.</div>
      </div>
    </div>

    <hr style="border:0;height:1px;background:#e5e7eb;margin:12px 0;">
    <div id="voting-form">
      <label for="voterName">Your Name (optional)</label>
      <input id="voterName" type="text" placeholder="Type your name (optional)">
      <div id="categoryContainer"></div>
      <div style="display:flex; gap:8px; margin-top:12px;">
        <button id="submitVoteBtn" class="btn-primary" style="flex:1">Submit Vote</button>
        <button id="clearBtn" class="btn-ghost small">Clear</button>
      </div>
      <div id="voteMsg" class="muted small" style="margin-top:10px"></div>
    </div>

    <div style="margin-top:16px; display:flex; justify-content:space-between; align-items:center;">
      <div class="small-muted">Have admin access?</div>
      <button id="adminToggleBtn" class="link-like">Admin Login</button>
    </div>

    <div id="adminLoginBox" class="hidden" style="margin-top:10px;">
      <div style="display:flex; gap:8px;">
        <input id="adminPassword" type="password" placeholder="Enter admin password" style="flex:1;">
        <button id="adminLoginBtn" class="inline-btn ok">Login</button>
      </div>
      <div id="adminLoginError" class="muted small" style="margin-top:8px;display:none;color:var(--danger)"></div>
    </div>

    <div class="footer">Data stored in your Firebase project. Make sure Firestore is enabled.</div>
  </div>

  <!-- Admin Panel -->
  <div class="card hidden" id="adminCard">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <div>
        <h2>Admin Panel</h2>
        <div class="muted small">Edit nominees & view live results</div>
      </div>
      <div style="display:flex; gap:8px;">
        <button id="adminLogoutBtn" class="inline-btn btn-ghost">Logout</button>
      </div>
    </div>

    <hr style="border:0;height:1px;background:#e5e7eb;margin:12px 0;">
    <div id="adminContent">
      <div>
        <h3 style="margin:0 0 8px 0">Manage Candidates</h3>
        <div id="categoriesEditor"></div>
      </div>

      <hr style="margin:12px 0; border:0; height:1px; background:#e5e7eb;">
      <div>
        <button id="clearVotesBtn" class="inline-btn danger">Clear All Votes</button>
      </div>

      <hr style="margin:12px 0; border:0; height:1px; background:#e5e7eb;">
      <div>
        <h3 style="margin:0 0 8px 0">Live Results</h3>
        <div id="liveResults"></div>
      </div>
    </div>
    <div class="footer">Admin-only view. Keep password secret.</div>
  </div>
</div>

<div id="copyright">
  <div>Â© 2025 Toastmasters Club of Pune Southeast</div>
  <div>Designed & Developed by TM Parth</div>
</div>

<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js';
import { getFirestore, collection, doc, getDoc, setDoc, addDoc, serverTimestamp, onSnapshot, deleteDoc, getDocs } from 'https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js';

const firebaseConfig = {
  apiKey: "AIzaSyAx-bH4o_M51tnzbWNNpqMVUprjobxliF0",
  authDomain: "toastmasters-voting.firebaseapp.com",
  projectId: "toastmasters-voting",
  storageBucket: "toastmasters-voting.appspot.com",
  messagingSenderId: "60056666317",
  appId: "1:60056666317:web:8c65a054d92c08500d2984"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const CATEGORY_ORDER = [
  { key: 'bestSpeaker', title: '1. Best Speaker' },
  { key: 'bestTableTopic', title: '2. Best Table Topic Speaker' },
  { key: 'bestEvaluator', title: '3. Best Evaluator' },
  { key: 'bestAuxiliary', title: '4. Best Auxiliary Role Player' },
  { key: 'bestMainRole', title: '5. Best Main Role Player' },
];

const ADMIN_PASSWORD = 'toastmaster123';

const categoryContainer = document.getElementById('categoryContainer');
const submitVoteBtn = document.getElementById('submitVoteBtn');
const clearBtn = document.getElementById('clearBtn');
const voteMsg = document.getElementById('voteMsg');
const adminToggleBtn = document.getElementById('adminToggleBtn');
const adminLoginBox = document.getElementById('adminLoginBox');
const adminLoginBtn = document.getElementById('adminLoginBtn');
const adminPasswordInput = document.getElementById('adminPassword');
const adminLoginError = document.getElementById('adminLoginError');
const adminCard = document.getElementById('adminCard');
const voterCard = document.getElementById('voterCard');
const adminLogoutBtn = document.getElementById('adminLogoutBtn');
const categoriesEditor = document.getElementById('categoriesEditor');
const liveResults = document.getElementById('liveResults');
const clearVotesBtn = document.getElementById('clearVotesBtn');

const candidatesCol = collection(db, 'candidates');
const votesCol = collection(db, 'votes');

let currentCandidates = {};
let unsubscribeCandidates = null;
let unsubscribeVotes = null;
let isAdmin = false;
let currentCategoryIndex = 0;

function qDocRef(categoryKey) { return doc(db, 'candidates', categoryKey); }

function renderCategoryForm() {
  if(currentCategoryIndex >= CATEGORY_ORDER.length){
    categoryContainer.innerHTML = '<div style="color:var(--ok)">You have voted for all categories. Thank you!</div>';
    submitVoteBtn.disabled = true;
    return;
  }
  const cat = CATEGORY_ORDER[currentCategoryIndex];
  const names = currentCandidates[cat.key] || [];
  categoryContainer.innerHTML = '';
  const label = document.createElement('label');
  label.textContent = cat.title;
  categoryContainer.appendChild(label);
  names.forEach(name=>{
    const div = document.createElement('div');
    const radio = document.createElement('input'); radio.type='radio'; radio.name='candidate'; radio.value=name;
    const span = document.createElement('span'); span.textContent=name; span.style.marginLeft='6px';
    div.appendChild(radio); div.appendChild(span);
    categoryContainer.appendChild(div);
  });
}

// Admin Editor
function renderAdminEditor() {
  categoriesEditor.innerHTML = '';
  CATEGORY_ORDER.forEach(cat=>{
    const box = document.createElement('div'); box.style.marginBottom='12px';
    const titleRow = document.createElement('div'); titleRow.style.display='flex'; titleRow.style.justifyContent='space-between'; titleRow.style.alignItems='center';
    const h = document.createElement('div'); h.textContent = cat.title; h.style.fontWeight='700';
    const saveBtn = document.createElement('button'); saveBtn.textContent='Save'; saveBtn.className='inline-btn ok'; saveBtn.style.fontSize='13px';
    saveBtn.onclick = async ()=>{
      const inputs = box.querySelectorAll('.cand-input');
      const names = Array.from(inputs).map(i=>i.value.trim()).filter(v=>v!=='');
      await setDoc(qDocRef(cat.key), { title:cat.title, names }, { merge:true });
    };
    titleRow.appendChild(h); titleRow.appendChild(saveBtn);
    box.appendChild(titleRow);

    const list = document.createElement('div'); list.style.marginTop='8px';
    const names = currentCandidates[cat.key]||[];
    names.forEach(nm=>{
      const row = document.createElement('div'); row.className='candidate-row';
      const inp = document.createElement('input'); inp.type='text'; inp.className='cand-input'; inp.value=nm;
      const del = document.createElement('button'); del.textContent='Delete'; del.className='inline-btn danger';
      del.onclick=()=>{ row.remove(); };
      row.appendChild(inp); row.appendChild(del);
      list.appendChild(row);
    });
    const newRow = document.createElement('div'); newRow.className='candidate-row';
    const newInp = document.createElement('input'); newInp.type='text'; newInp.placeholder='Add candidate name'; newInp.className='cand-input';
    const addBtn = document.createElement('button'); addBtn.textContent='Add'; addBtn.className='inline-btn';
    addBtn.onclick = ()=>{
      const val=newInp.value.trim(); if(!val) return;
      const row = document.createElement('div'); row.className='candidate-row';
      const inp = document.createElement('input'); inp.type='text'; inp.className='cand-input'; inp.value=val;
      const del = document.createElement('button'); del.textContent='Delete'; del.className='inline-btn danger';
      del.onclick=()=>{ row.remove(); };
      row.appendChild(inp); row.appendChild(del);
      list.appendChild(row); newInp.value='';
    };
    newRow.appendChild(newInp); newRow.appendChild(addBtn);
    list.appendChild(newRow);
    box.appendChild(list);
    categoriesEditor.appendChild(box);
  });
}

// Render Results
function renderResults(snapshot){
  liveResults.innerHTML='';
  const votesData={};
  CATEGORY_ORDER.forEach(cat=>votesData[cat.key]={});
  
  snapshot.forEach(doc=>{
    const data = doc.data();
    CATEGORY_ORDER.forEach(cat=>{
      const vote = data[cat.key];
      if(vote) votesData[cat.key][vote] = (votesData[cat.key][vote]||0)+1;
    });
  });

  CATEGORY_ORDER.forEach(cat=>{
    const div = document.createElement('div');
    const h = document.createElement('div'); h.textContent=cat.title; h.style.fontWeight='700'; div.appendChild(h);
    const names = votesData[cat.key];
    Object.keys(names).forEach(nm=>{
      const resDiv = document.createElement('div'); resDiv.className='results-item';
      resDiv.innerHTML=`<span>${nm}</span><span>${names[nm]}</span>`;
      div.appendChild(resDiv);
    });
    liveResults.appendChild(div);
  });
}

// Load Candidates
unsubscribeCandidates = onSnapshot(candidatesCol, snapshot=>{
  snapshot.forEach(doc=>{ currentCandidates[doc.id] = doc.data().names || []; });
  renderCategoryForm();
  if(isAdmin) renderAdminEditor();
});

// Live votes
unsubscribeVotes = onSnapshot(votesCol, snapshot=>{
  if(isAdmin) renderResults(snapshot);
});

// Voting
submitVoteBtn.onclick = async ()=>{
  if(currentCategoryIndex >= CATEGORY_ORDER.length) return;
  const radios = document.querySelectorAll('input[name=candidate]');
  const selected = Array.from(radios).find(r=>r.checked);
  if(!selected){ voteMsg.textContent='Please select a candidate'; return; }
  const voterName = document.getElementById('voterName').value.trim();
  const voteObj = {};
  voteObj[CATEGORY_ORDER[currentCategoryIndex].key] = selected.value;
  if(voterName) voteObj['voterName']=voterName;
  voteObj['timestamp']=serverTimestamp();
  await addDoc(votesCol, voteObj);
  voteMsg.textContent=`Vote submitted for "${CATEGORY_ORDER[currentCategoryIndex].title}"`;
  currentCategoryIndex++;
  setTimeout(()=>{ voteMsg.textContent=''; renderCategoryForm(); }, 1200);
};

// Clear form
clearBtn.onclick=()=>{ document.querySelectorAll('input[name=candidate]').forEach(r=>r.checked=false); document.getElementById('voterName').value=''; voteMsg.textContent=''; };

// Admin login toggle
adminToggleBtn.onclick=()=>{ adminLoginBox.classList.toggle('hidden'); };

// Admin login
adminLoginBtn.onclick=()=>{
  if(adminPasswordInput.value===ADMIN_PASSWORD){
    isAdmin=true;
    adminCard.classList.remove('hidden');
    voterCard.classList.add('hidden');
    adminLoginBox.classList.add('hidden');
    adminLoginError.style.display='none';
    renderAdminEditor();
    getDocs(votesCol).then(snap=>renderResults(snap));
  } else {
    adminLoginError.textContent='Incorrect password'; adminLoginError.style.display='block';
  }
};

// Admin logout
adminLogoutBtn.onclick=()=>{ isAdmin=false; adminCard.classList.add('hidden'); voterCard.classList.remove('hidden'); };

// Clear all votes
clearVotesBtn.onclick=async()=>{
  const snap = await getDocs(votesCol);
  snap.forEach(async docSnap=>{ await deleteDoc(doc(votesCol, docSnap.id)); });
};
</script>
</body>
</html>
